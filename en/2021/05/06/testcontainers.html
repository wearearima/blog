<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com https://www.gstatic.com https://platform.twitter.com https://cdn.syndication.twimg.com https://syndication.twitter.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://www.google-analytics.com https://www.googletagmanager.com https://pbs.twimg.com https://ton.twimg.com https://abs.twimg.com; font-src 'self' data:; connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com https://stats.g.doubleclick.net https://region1.google-analytics.com https://platform.twitter.com https://cdn.syndication.twimg.com https://syndication.twitter.com; frame-src https://platform.twitter.com https://www.youtube.com; frame-ancestors 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; manifest-src 'self'; upgrade-insecure-requests;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="accelerometer=(), camera=(), geolocation=(), gyroscope=(), microphone=(), payment=(), usb=()">
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">

  <title>Testcontainers: containers for testing</title>
  <meta name="description" content="I’ve always been more of a fan of unit tests than integration tests, mainly for one reason: I don’t need anything external to be able to run them. I don’t ne...">
  
  <meta name="keywords" content="testing,calidad,softwarequality,QA,testContainers,testintegración">
  

  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@wearearima">
  <meta name="twitter:creator" content="@jessica">
  <meta name="twitter:title"   content="Testcontainers: containers for testing">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary_large_image">
  <meta name="twitter:image" content="https://blog.arima.eu/assets/images/2021-05-06-testcontainers/header.jpg">
  
  <!-- end of Twitter cards -->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.arima.eu/en/2021/05/06/testcontainers.html">
  <link rel="alternate" type="application/rss+xml" title="ARIMA" href="/en/feed.xml">

  <!-- SEO Recipes (http://polyglot.untra.io/seo/) -->
  <meta http-equiv="Content-Language" content="en">
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/en/2021/05/06/testcontainers.html" />
  
  
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/es/2021/05/06/testcontainers.html" />
  
  
  <link rel="alternate"
      hreflang="en"
      href="https://blog.arima.eu/en/2021/05/06/testcontainers.html" />
  
  
  <link rel="alternate"
      hreflang="eu"
      href="https://blog.arima.eu/en/eus/2021/05/06/testcontainers.html" />
  

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120217722-1"></script>
<script defer src="/assets/google-analytics.js"></script>

  
</head>

  

  <body>
    <nav class="toolbar">
    <div class="wrapper">    
        <a href="/en/">
            <div class="toolbar__logo">
                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" width="100%" height="100%" viewBox="0 0 33 6">
    <path id="path24" d="m30.346988508615652,-0.000015174522529526127 l-0.6439224998849951,0 l-2.7763635316117727,6.135695064030662 l0.7050150612484405,0 l2.3859233880279893,-5.335002838884215 l2.3660424189063254,5.335002838884215 l0.739668694925785,0 L30.346988508615652,-0.000015174522529526127 zm-8.274141805179609,3.3681675186951847 l-2.2194202716340565,-3.324608867598761 l-0.6962481061149294,0 l0,6.092136412934239 l0.6700853029999622,0 l0,-4.926062349034439 l2.2194202716340565,3.2553706313868567 l0.034929758248478535,0 l2.2192131782057056,-3.2639304930920168 l0,4.934622210739599 l0.6873430886958508,0 l0,-6.092136412934239 l-0.6961100438293623,0 l-2.2192131782057056,3.324608867598761 zm-9.143036799396208,-1.5057072863948877 c0,-1.0964906719739773 -0.8613705996531913,-1.8189015812038738 -2.201748299081466,-1.8189015812038738 l-2.619662837493104,0 l0,6.092136412934239 l0.6876192132669849,0 l0,-5.456842805897188 l1.8799251114245357,0 c0.9833486289517317,0 1.5576187057681203,0.4525681720889824 1.5576187057681203,1.2097017461390067 c0,0.7919252700129356 -0.7831583148794242,1.2620273523689407 -1.6968545207625496,1.2620273523689407 l0,0.6178287279128115 l1.7665759749739396,2.3672849794764295 l0.8442508762428699,0 l-1.8711581562910244,-2.4891249464894027 c0.9571858258367647,-0.17416557324290774 1.6534339319516944,-0.7659695603263191 1.6534339319516944,-1.7841098852409623 m2.7743616284710493,4.273234831730365 l0.6872050264102838,0 l0,-6.0920673817914555 l-0.6872050264102838,0 l0,6.0920673817914555 zM2.7761571742923965,-0.000015174522529526127 l-2.7761564381834223,6.135695064030662 l0.7048769989628736,0 l2.386061450313556,-5.335002838884215 l2.3658353254779745,5.335002838884215 l0.739668694925785,0 l-2.7761564381834223,-6.135695064030662 l-0.6441295933133457,0 z" stroke-width="0"/>
</svg>

            </div>
        </a>
        <!-- Language selector -->
        <div class="language-selector">
            
              
                <a class="unselected" href="/es/2021/05/06/testcontainers.html">ES</a>
              
              
                &nbsp;|&nbsp;
              
            
              
                <b class="selected">EN</b>
              
              
                &nbsp;|&nbsp;
              
            
              
                <a class="unselected" href="/eu/2021/05/06/testcontainers.html">EU</a>
              
              
            
         </div>
    </div>
</nav>
<div id="publisher_id" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Arima 100% Software Design" />
    <meta itemprop="url" content="https://arima.eu" />
    <div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
        <meta itemprop="url" content="https://arima.eu/img/logo.png" />
    </div>
</div>
    <main aria-label="Content">        
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting" itemref="publisher_id">
          <link itemprop="mainEntityOfPage" href="/en/2021/05/06/testcontainers.html" />

          <header class="post-header">
            <div class="post-img" itemprop="image" itemscope itemtype="http://schema.org/ImageObject" style="background-image: url('https://blog.arima.eu/assets/images/2021-05-06-testcontainers/header.jpg');">
              <meta itemprop="url" content="https://blog.arima.eu/assets/images/2021-05-06-testcontainers/header.jpg" />
            </div>
            <div class="wrapper">
              <div class="post-info__container">
                <div class="post-info">
                  <h1 class="post-title" itemprop="name headline">Testcontainers: containers for testing</h1>
                    <div class="post-meta" itemscope itemtype="https://schema.org/Person" itemprop="author">
                      
                      <div class="author-photo">
                        <img itemprop="image" src="/assets/images/authors/jessica.png" alt="">
                      </div>
                      <div>
                        <span class="post-author" itemprop="name">Jessica Aguado</span>
                      </div>
                      <div>
                        <span class="post-date">05-06-2021</span>
                      </div>
                    </div>
                    <meta  itemprop="datePublished dateModified" content="05-06-2021" />
                </div>
              </div>
            </div>
          </header>
          <div class="wrapper">
            <div class="post-content" itemprop="articleBody">
              <p>I’ve always been more of a fan of unit tests than integration tests, mainly for one reason: I don’t need anything external to be able to run them. I don’t need to have a database started, an external service to connect to or a Kafka running to be able to run the tests and therefore to be able to develop.
That’s in the development environment, but if we’re talking about the integration environment, then I won’t even start.
For example, in the case of databases we have the option of doing the tests with H2. But it is also true that depending on the type of project, it could be that something which works perfectly in H2 does not work in the database for which we are developing:
As sure as we have often relied on</p>
<blockquote>
  <p>“Let’s go … with h2, so as not to start the db …”</p>
</blockquote>

<p>so is the situation</p>
<blockquote>
  <p>“But it has been tested! Then why …? Oops … “</p>
</blockquote>

<p>I have always been one of those who needed to have everything installed: Mysql, Postgres, Kafka, …. everything that was necessary to execute the project. So, depending on the project, I had to make sure I had everything installed and some services or others called up … until through my colleagues, I discovered containers. Well, Docker.
I have never been very good with these things, but the truth is that thanks to them, I don’t need to have millions of things installed: I have the images of the services I need and I only have to start the ones I need, and that’s all.
OK up to a point. It’s true that now to run the applications I have everything much more organized, but to actually develop, I’m still in pretty much the same situation: if I want to run integration tests, I have to remember to build the database (for example), so it ends up not being as transparent as H2.</p>

<p><small>As some may have already been thinking, all this makes sense in CI too, but I am going to focus on the day-to-day of the developer and how this tool helps us in our everyday work.<small></small></small></p>

<blockquote>
  <p>“There must be something that unites both worlds and makes the tests self-sufficient by simulating a real environment”</p>
</blockquote>

<p>With this idea in mind and after a conversation with a colleague, I discovered that it was so: there was something called <a href="https://www.testcontainers.org/" target="_blank"><strong>TestContainers</strong></a>!</p>

<p>For example, let’s imagine some situations in the day that make us sigh (or rather huff): a new member on the team! Or if we want to ask a colleague for help with a use case or a bug? Or if we go back to a project that we haven’t worked on for months?
In situations like these (and others) how many times have we thought: wouldn’t it be possible to download everything and be able to run the tests and start developing without doing absolutely anything else?
Some time ago, while watching a presentation from <a href="https://twitter.com/kiview" target="_blank">@kiview</a>, I realized that I was not alone. At the beginning of his presentation he said something like:</p>
<blockquote>
  <p>… a successful onboarding experience in a project would be that the developer only had to clone the repository, do the build and with that we would already have the build done including unit and integration tests …</p>
</blockquote>

<p>In other words, to follow these steps:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; git clone https://github.com/wearearima/school-library-testcontainers-01.git
&gt; cd school-library-testcontainers-01
&gt; ./mvnw install
</code></pre></div></div>

<p>That’s it!
My eyes were popping 😍. The talk was titled <a href="https://www.youtube.com/watch?v=Lv1evJe2MRI">Integration Testing with Docker and Testcontainers</a>, exactly: <strong>TestContainers</strong>. So, good news! It seems that working with <strong>TestContainers</strong> makes it easier for us to get closer to that goal and simplifies our work so that we can focus on the development itself (implicitly, on the tests).</p>

<h1 id="database-container-example-postgres-module">Database container example (Postgres Module)</h1>
<p>Told this way, everything sounds very good, but (as those who read me from time to time will know well) to understand the concepts, I have to put them into practice, so we have prepared an example in <a href="https://github.com/wearearima/school-library-testcontainers-01" target="_blank">Github</a>.
The most common is probably the situation in which we do tests against databases and Testcontainers offer us different <em>modules</em> for different databases. Therefore, we have prepared a simple example of a Spring Boot application that connects to a Postgres database.<br />
Our example:<br />
    <em>Let’s take the case of a school library. We have a functionality that will serve to register the book copies that we receive. One of the methods that we could use, would be to “add a copy of a book” (understanding “book” as the concept and “copy” the representation of each printed copy that we have).</em><br />
<small>In the future we will continue to develop this example and add code.</small></p>

<p>As we have said, we will use the module that exists for <a href="https://www.testcontainers.org/modules/databases/postgres/" target="_blank">Postgres</a>. The implementation of the tests is very simple using this container. Let’s go!</p>

<h2 id="install-docker">Install Docker</h2>
<p>The first thing we need to do is to install <a href="https://www.docker.com/products/docker-desktop" target="_blank">Docker Desktop</a> (in case we don’t have it). This is the documentation section where we can find the Docker requirements: <a href="https://www.testcontainers.org/supported_docker_environment/" target="_blank">General Docker requirements</a>.</p>

<h2 id="add-the-necessary-dependencies">Add the necessary dependencies</h2>
<p>To start with the code, the first thing we will have to do is add the necessary dependencies to the project (in our case in the pom.xml).</p>

<p>In our case we have generated the project using <a href="https://start.spring.io/" target="_blank">Spring Initializr</a>, from where we have added the dependency</p>

<p><img src="/assets/images/2021-05-06-testcontainers/spring-initializr.png" alt="Imagen de cómo se añade la depedencia de testscontainer utilizando springinitializr" class="center" /></p>

<p>If doing it manually, in the <a href="https://www.testcontainers.org/quickstart/junit_5_quickstart/#1-add-testcontainers-as-a-test-scoped-dependency" target="_blank">documentation</a> it details how to add the dependencies.</p>

<p>Also, since we are going to use the Postgres module, we add the dependency:</p>

<h4 id="pomxml">pom.xml</h4>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>So, in the same way we would if we weren’t using Testcontainers, we will include the Postgres dependency.</p>

<h4 id="pomxml-1">pom.xml</h4>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="start-coding">Start coding!</h2>
<p>And we’re ready! We can now implement our use case. We are going to implement more than one test (available in <a href="https://github.com/wearearima/school-library-testcontainers-01/blob/master/src/test/java/eu/arima/schoolLibrary/bookStore/BooksServiceTest.java" target="_blank">Github</a>. ), and here we will see the code for one of them. It’s a test that we will do to verify that when we add a copy to a book whose ISBN already exists, the copy will be added to the same one. Simple right?</p>

<h4 id="booksservicetestjava">BooksServiceTest.java</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Transactional</span>
<span class="kd">class</span> <span class="nc">BooksServiceTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">BooksService</span> <span class="n">booksService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">BooksRepository</span> <span class="n">booksRepository</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CopiesRepository</span> <span class="n">copiesRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"addCopy for a book that exists with the provided isbn adds a new copy to it"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">addCopy_if_book_exist_adds_new_copy</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">isbn</span> <span class="o">=</span> <span class="s">"9780745168197"</span><span class="o">;</span>
        <span class="nc">Book</span> <span class="n">existingBook</span> <span class="o">=</span> <span class="n">booksRepository</span><span class="o">.</span><span class="na">findBookByIsbnEquals</span><span class="o">(</span><span class="n">isbn</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">existingNumCopies</span> <span class="o">=</span> <span class="n">existingBook</span><span class="o">.</span><span class="na">getCopies</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>

        <span class="nc">Copy</span> <span class="n">createdCopy</span> <span class="o">=</span> <span class="n">booksService</span><span class="o">.</span><span class="na">addCopy</span><span class="o">(</span><span class="n">existingBook</span><span class="o">.</span><span class="na">getTitle</span><span class="o">(),</span> <span class="n">existingBook</span><span class="o">.</span><span class="na">getAuthors</span><span class="o">(),</span> <span class="n">isbn</span><span class="o">);</span>

        <span class="nc">Book</span> <span class="n">updatedBook</span> <span class="o">=</span> <span class="n">booksRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">existingBook</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">assertAll</span><span class="o">(</span>
                <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">assertEquals</span><span class="o">(</span><span class="n">existingNumCopies</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">updatedBook</span><span class="o">.</span><span class="na">getCopies</span><span class="o">().</span><span class="na">size</span><span class="o">()),</span>
                <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">assertRelationBetweenBookAndCopyIsCorrect</span><span class="o">(</span><span class="n">createdCopy</span><span class="o">,</span> <span class="n">updatedBook</span><span class="o">));</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>But if we run the test without doing anything else, we will see that it fails due to not being able to raise the context: it is missing the information from the database.
It is true that we could go to <code class="highlighter-rouge">application.properties</code> and set the values ​​there … but that would require any new developer (or you who is going to download the example) to raise the database etc. It would no longer be the “ideal” we are looking for. The solution?</p>

<h3 id="testcontainers">@Testcontainers</h3>
<p>Effectively an annotation <code class="highlighter-rouge">@Testcontainers</code> and a few more lines and we have it:</p>

<h4 id="booksservicetestjava-1">BooksServiceTest.java</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Transactional</span>
<span class="nd">@Testcontainers</span>
<span class="kd">class</span> <span class="nc">BooksServiceTest</span> <span class="o">{</span>

    <span class="nd">@Container</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">PostgreSQLContainer</span> <span class="n">postgresContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">(</span><span class="nc">DockerImageName</span>
            <span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"postgres:13"</span><span class="o">));</span>

    <span class="nd">@DynamicPropertySource</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">databaseProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.url"</span><span class="o">,</span> <span class="nl">postgresContainer:</span><span class="o">:</span><span class="n">getJdbcUrl</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.username"</span><span class="o">,</span> <span class="nl">postgresContainer:</span><span class="o">:</span><span class="n">getUsername</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.password"</span><span class="o">,</span> <span class="nl">postgresContainer:</span><span class="o">:</span><span class="n">getPassword</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<p>So what have we done?</p>
<ul>
  <li>We have added the annotation <code class="highlighter-rouge">@Testcontainers</code> to the test class.</li>
  <li>We have created a container instance with Postgres using the <code class="highlighter-rouge">@Container</code> annotation and specifying the version.</li>
  <li>And finally we have set the datasource information from the container created by <code class="highlighter-rouge">@ DynamicPropertySource</code>.</li>
</ul>

<p>As you can see, the implementation is very simple and the benefit is instantaneous: you can download the example and run it directly on your equipment with nothing more than having installed Docker (do you remember the 3 commands from before? You can try it.)</p>

<h3 id="singleton-pattern">Singleton pattern</h3>
<p>There is another way to implement all this more efficiently, by using the singleton pattern. In this way we would use the same container in more than one class.
In fact, the documentation recommends this approach. In this example where we only have one test class, it doesn’t seem useful, but it probably won’t be the only functionality of our project, right? When that moment arrives, then yes, we would move to the singleton pattern, as explained <a href="https://www.testcontainers.org/test_framework_integration/manual_lifecycle_control/#singleton-containers" target="_blank">here</a>.</p>

<p>Let’s see how it would work:</p>

<h4 id="booksservicetestjava-2">BooksServiceTest.java</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Transactional</span>
<span class="kd">class</span> <span class="nc">BooksServiceTest</span> <span class="kd">extends</span> <span class="nc">PostgresContainerBaseTest</span> <span class="o">{</span>
    <span class="c1">//Ya no es necesario @Container ni @DynamicPropertySource porque lo gestionaremos en PostgresContainerBaseTest</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="postgrescontainerbasetestjava">PostgresContainerBaseTest.java</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">PostgresContainerBaseTest</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PostgreSQLContainer</span> <span class="n">postgresContainer</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">postgresContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="nc">DockerImageName</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"postgres:13"</span><span class="o">));</span>
        <span class="n">postgresContainer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@DynamicPropertySource</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">databaseProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.url"</span><span class="o">,</span> <span class="nl">postgresContainer:</span><span class="o">:</span><span class="n">getJdbcUrl</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.username"</span><span class="o">,</span> <span class="nl">postgresContainer:</span><span class="o">:</span><span class="n">getUsername</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.password"</span><span class="o">,</span> <span class="nl">postgresContainer:</span><span class="o">:</span><span class="n">getPassword</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="tip-relating-to-pitest">Tip relating to Pitest</h2>
<p><a href="https://pitest.org/" target="_blank">PIT</a>? What do <strong>Testcontainers</strong> have to do with <strong>PIT</strong>? Let’s remember that we discovered that we could <a href="https://blog.arima.eu/es/2020/05/25/mutation-testing.html" target="_blank">measure the quality of our tests with PIT</a>. It is true that PIT is directly oriented to <strong>unit tests</strong> (mainly due to time/efficiency), but it is also true that until now we had not encountered any problem when testing our <strong>integration tests</strong>.</p>

<p>However, if you try to run Pitest on tests implemented using <code class="highlighter-rouge">@Testcontainers</code> you will find that they fail. On the other hand, if the tests are implemented using the singleton pattern, you will be able to perform the Pit coverage analysis without problems.</p>

<p><em>If anyone wants to know the reason for all this, in addition to testing a solution proposed by a contributor, they can do so in the <a href="https://github.com/hcoles/pitest/issues/827" target="_blank">issue</a> that we opened when detecting the problem.</em></p>

<p>So for now, a short introduction to <strong>Testcontainers</strong>, with an application example in the case of a database. As we have mentioned before, Testcontainers offer us many other modules. And even if for our requirements we need something more specific, they also dispose of support for us to have our own <code class="highlighter-rouge">docker-compose.yml</code> as explained in the <a href="https://www.testcontainers.org/modules/docker_compose/">documentation</a>.</p>

<p>In future posts, we will develop our application so that we can introduce some examples of other use cases in which to use Testcontainers (to see in a practical way their ease of use and their advantages).</p>


            </div>

            
          </div>
        </article>
      </div>
    </main>

    <footer>
    <div class="wrapper">
        <div class="footer__container">
            <div class="footer__sello">
                <img src="/assets/images/arima_sello_white.png" alt="" />
            </div>
            <div class="footer__content">
                <div class="footer__data">
                    <dl>
                        <dt>web</dt>
                        <dd><a itemprop="sameAs" href="https://www.arima.eu/en/">arima.eu</a></dd>
                    </dl>
                    <dl>
                        <dt>social</dt>
                        <dd>
                            <a itemprop="sameAs" href="https://github.com/wearearima" class="social"><span class="icon-github"></span></a>
                            <a itemprop="sameAs" href="https://twitter.com/wearearima" class="social"><span class="icon-twitter"></span></a>
                            <a itemprop="sameAs" href="https://www.linkedin.com/company/arima-software-design/" class="social"><span class="icon-linkedin"></span></a>
                            <a itemprop="sameAs" href="/en/feed.xml" class="social"><span class="icon-feed"></span></a>
                        </dd>
                    </dl>
                    <dl>
                        <dt>Privacy</dt>
                        <dd class="politica-cookies">
                            <a href="/en/cookies.html">Cookies Policy</a>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</footer>
    <div class="cookies-message" id="cookies-message">
    <h4>This website uses cookies</h4>
    <p>This website uses cookies to improve user experience. By continuing to browse this website, you agree to the use of cookies as stated in our Cookies Policy.</p>
    <div class="buttons">
        <a class="button" href="/en/cookies.html">Read Cookies Policy</a>
        <button class="button" id="accept-cookies">Accept</button>
    </div>
</div>
<script defer src="/assets/cookies-message.js"></script>


  </body>

</html>