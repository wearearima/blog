<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CVE-2020-8554: Man in the Middle - Vulnerabilidad en Kubernetes</title>
  <meta name="description" content="Cada día se descubren nuevas vulnerabilidades que afectan a las librerías y productos que utilizamos a diario. Hoy le ha tocado a Kubernetes.">
  
  <meta name="keywords" content="kubernetes,docker,cve,vulnerabilidades">
  

  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@wearearima">
  <meta name="twitter:creator" content="@fernando">
  <meta name="twitter:title"   content="CVE-2020-8554: Man in the Middle - Vulnerabilidad en Kubernetes">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary_large_image">
  <meta name="twitter:image" content="https://blog.arima.eu/assets/images/2020-12-12-cve-kubernetes/header.jpg">
  
  <!-- end of Twitter cards -->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.arima.eu/en/2020/12/12/CVE-2020-8554-kubernetes.html">
  <link rel="alternate" type="application/rss+xml" title="ARIMA" href="/en/feed.xml">

  <!-- SEO Recipes (http://polyglot.untra.io/seo/) -->
  <meta http-equiv="Content-Language" content="en">
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/en/2020/12/12/CVE-2020-8554-kubernetes.html" />
  
  
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/es/2020/12/12/CVE-2020-8554-kubernetes.html" />
  
  
  <link rel="alternate"
      hreflang="en"
      href="https://blog.arima.eu/en/2020/12/12/CVE-2020-8554-kubernetes.html" />
  

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120217722-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120217722-1');
</script>
  
</head>

  <body>
    <nav class="toolbar">
    <div class="wrapper">    
        <a href="/en/">
            <div class="toolbar__logo">
                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" width="100%" height="100%" viewBox="0 0 33 6">
    <path id="path24" d="m30.346988508615652,-0.000015174522529526127 l-0.6439224998849951,0 l-2.7763635316117727,6.135695064030662 l0.7050150612484405,0 l2.3859233880279893,-5.335002838884215 l2.3660424189063254,5.335002838884215 l0.739668694925785,0 L30.346988508615652,-0.000015174522529526127 zm-8.274141805179609,3.3681675186951847 l-2.2194202716340565,-3.324608867598761 l-0.6962481061149294,0 l0,6.092136412934239 l0.6700853029999622,0 l0,-4.926062349034439 l2.2194202716340565,3.2553706313868567 l0.034929758248478535,0 l2.2192131782057056,-3.2639304930920168 l0,4.934622210739599 l0.6873430886958508,0 l0,-6.092136412934239 l-0.6961100438293623,0 l-2.2192131782057056,3.324608867598761 zm-9.143036799396208,-1.5057072863948877 c0,-1.0964906719739773 -0.8613705996531913,-1.8189015812038738 -2.201748299081466,-1.8189015812038738 l-2.619662837493104,0 l0,6.092136412934239 l0.6876192132669849,0 l0,-5.456842805897188 l1.8799251114245357,0 c0.9833486289517317,0 1.5576187057681203,0.4525681720889824 1.5576187057681203,1.2097017461390067 c0,0.7919252700129356 -0.7831583148794242,1.2620273523689407 -1.6968545207625496,1.2620273523689407 l0,0.6178287279128115 l1.7665759749739396,2.3672849794764295 l0.8442508762428699,0 l-1.8711581562910244,-2.4891249464894027 c0.9571858258367647,-0.17416557324290774 1.6534339319516944,-0.7659695603263191 1.6534339319516944,-1.7841098852409623 m2.7743616284710493,4.273234831730365 l0.6872050264102838,0 l0,-6.0920673817914555 l-0.6872050264102838,0 l0,6.0920673817914555 zM2.7761571742923965,-0.000015174522529526127 l-2.7761564381834223,6.135695064030662 l0.7048769989628736,0 l2.386061450313556,-5.335002838884215 l2.3658353254779745,5.335002838884215 l0.739668694925785,0 l-2.7761564381834223,-6.135695064030662 l-0.6441295933133457,0 z" stroke-width="0"/>
</svg>

            </div>
        </a>
        <!-- Language selector -->
        <div class="language-selector">
            
              
                <a class="unselected" href="/es/2020/12/12/CVE-2020-8554-kubernetes.html">ES</a>
              
              
                &nbsp;|&nbsp;
              
            
              
                <b class="selected">EN</b>
              
              
            
         </div>
    </div>
</nav>
<div id="publisher_id" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Arima 100% Software Design" />
    <meta itemprop="url" content="https://arima.eu" />
    <div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
        <meta itemprop="url" content="https://arima.eu/img/logo.png" />
    </div>
</div>
    <main aria-label="Content">        
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting" itemref="publisher_id">
          <link itemprop="mainEntityOfPage" href="/en/2020/12/12/CVE-2020-8554-kubernetes.html" />

          <header class="post-header">
            <div class="post-img" itemprop="image" itemscope itemtype="http://schema.org/ImageObject" style="background-image: url('https://blog.arima.eu/assets/images/2020-12-12-cve-kubernetes/header.jpg');">
              <meta itemprop="url" content="https://blog.arima.eu/assets/images/2020-12-12-cve-kubernetes/header.jpg" />
            </div>
            <div class="wrapper">
              <div class="post-info__container">
                <div class="post-info">
                  <h1 class="post-title" itemprop="name headline">CVE-2020-8554: Man in the Middle - Vulnerabilidad en Kubernetes</h1>
                    <div class="post-meta" itemscope itemtype="https://schema.org/Person" itemprop="author">
                      
                      <div class="author-photo">
                        <img itemprop="image" src="/assets/images/authors/fernando.png" alt="">
                      </div>
                      <div>
                        <span class="post-author" itemprop="name">Fernando Lozano</span>
                      </div>
                      <div>
                        <span class="post-date">12 Dec 2020</span>
                      </div>
                    </div>
                    <meta  itemprop="datePublished dateModified" content="12 Dec 2020" />
                </div>
              </div>
            </div>
          </header>
          <div class="wrapper">
            <div class="post-content" itemprop="articleBody">
              <p>Cada día se descubren nuevas vulnerabilidades que afectan a las librerías y productos que utilizamos a diario. Hoy le ha tocado a Kubernetes.</p>

<p>El <em>Kubernetes Product Security Committee</em> reveló un nuevo problema de seguridad (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8554">CVE-2020-8554</a>) que afecta a todas las versiones de Kubernetes. Es de gravedad media y no hay ningún parche disponible.</p>

<p>Se recomienda a los administradores de Kubernetes que:</p>

<ul>
  <li>Limiten ciertos permisos del clúster.</li>
  <li>Restrinjan y auditen manualmente el uso de IP externas dentro de los clústeres.</li>
</ul>

<p>También se recomienda que los escenarios de clústeres <em>multi-tentant</em> se reconsideren cuando sea posible y apropiado.</p>

<h2 id="resumen-de-la-vulnerabilidad">Resumen de la vulnerabilidad</h2>

<p>CVE-2020-8554 es una vulnerabilidad de Man in the Middle (MITM) que existe en todas las versiones de Kubernetes con el impacto más significativo en los clústeres <em>multi-tentant</em>.</p>

<p>Puede ser explotado por usuarios con permisos básicos, como crear o editar servicios y pods en un clúster de Kubernetes. Un usuario que tenga estos permisos puede interceptar el tráfico de otros pods en el clúster. Esto se hace más fácilmente creando un servicio, que permite al usuario especificar una dirección IP de clúster y también exponer un servicio utilizando una dirección IP externa. El tráfico a esa dirección IP externa desde el clúster se enrutará a ese servicio, lo que permitirá al usuario interceptarlo.</p>

<p>Esto también se puede lograr al parchear el estado de un servicio de <em>load balancer</em>. Vale la pena señalar que la vulnerabilidad en sí misma no otorga a los usuarios no autorizados la capacidad de crear servicios de Kubernetes.</p>

<h2 id="versiones-de-kubernetes-afectadas">Versiones de Kubernetes afectadas</h2>
<p>Todas las versiones de Kubernetes (v1.0-1.20) se ven afectadas, lo que hace que el alcance de esta vulnerabilidad sea significativo. Sin embargo, las circunstancias en las que los clústeres son más vulnerables son principalmente aquellos que ejecutan <em>multi-tentant</em>.</p>

<h2 id="por-qué-es-importante-esta-vulnerabilidad">¿Por qué es importante esta vulnerabilidad?</h2>
<p>El impacto de esta vulnerabilidad es preocupante porque la realidad es que muchos clústeres de Kubernetes en la actualidad son <em>multi-tentant</em>, con muchos usuarios compartiendo el acceso para crear servicios y lo más preocupante es que <strong>este problema se debe a un fallo de diseño</strong>, como comenta Tim Allclair (Kubernetes Security en @Apple) en un reciente tuit.</p>

<center>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Interesting <a href="https://twitter.com/hashtag/Kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#Kubernetes</a> security announcement today. Is this the first CVE we&#39;ve had where a feature was fundamentally flawed and couldn&#39;t be patched? <a href="https://t.co/WEv765LJLI">https://t.co/WEv765LJLI</a></p>&mdash; Tim Allclair (@tallclair) <a href="https://twitter.com/tallclair/status/1336002092859715584?ref_src=twsrc%5Etfw">December 7, 2020</a></blockquote> <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>

<p>En este caso, la vulnerabilidad surge de los permisos de usuario básicos, lo que significa que los ataques se pueden llevar a cabo con baja complejidad.</p>

<p>La comunidad de Kubernetes deberá determinar la mejor manera de abordar este problema a más largo plazo, y parece que requerirá cambios de diseño incompatibles con versiones anteriores.</p>

<h2 id="recomendaciones">Recomendaciones</h2>

<p>Dada la ausencia de un parche para esta vulnerabilidad, el único enfoque que se puede tomar es aplicar las mitigaciones adecuadas.</p>

<p>Para ello, tenemos herramientas como <a href="https://www.openpolicyagent.org/" target="_blank">Open Policy Agent (OPA)</a>, un motor de políticas que proporciona un lenguaje declarativo de alto nivel para definir y hacer cumplir políticas para diferentes sistemas, incluido Kubernetes.</p>

<p>En posteriores posts explicaremos más en profundidad por qué OPA nos parece una herramienta interesante que nos permite aumentar la calidad de nustros clústeres de Kubernetes.</p>

<p>Mi consejo para este CVE en concreto es que los administradores restrinjan el uso de direcciones IP externas con uno de los siguientes métodos:</p>

<ul>
  <li>OPA Gatekeeper: una plantilla de restricción de muestra está disponible <a href="https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/externalip">aquí</a></li>
  <li>Con el concepto de Kubernetes, Admission Controller: se puede encontrar un ejemplo <a href="https://github.com/kubernetes-sigs/externalip-webhook">aquí</a></li>
</ul>

<p>Espero que os sirva de ayuda. Feliz parcheo! :)</p>

            </div>

            
          </div>
        </article>
      </div>
    </main>

    <footer>
    <div class="wrapper">
        <div class="footer__container">
            <div class="footer__sello">
                <img src="/assets/images/arima_sello_white.png" alt="" />
            </div>
            <div class="footer__content">
                <div class="footer__data">
                    <dl>
                        <dt>web</dt>
                        <dd><a itemprop="sameAs" href="https://www.arima.eu/en/">arima.eu</a></dd>
                    </dl>
                    <dl>
                        <dt>social</dt>
                        <dd>
                            <a itemprop="sameAs" href="https://github.com/wearearima" class="social"><span class="icon-github"></span></a>
                            <a itemprop="sameAs" href="https://twitter.com/wearearima" class="social"><span class="icon-twitter"></span></a>
                            <a itemprop="sameAs" href="https://www.linkedin.com/company/arima-software-design/" class="social"><span class="icon-linkedin"></span></a>
                            <a itemprop="sameAs" href="/en/feed.xml" class="social"><span class="icon-feed"></span></a>
                        </dd>
                    </dl>
                    <dl>
                        <dt>Privacy</dt>
                        <dd class="politica-cookies">
                            <a href="/en/cookies.html">Cookies Policy</a>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</footer>
    <div class="cookies-message" id="cookies-message">
    <h4>This website uses cookies</h4>
    <p>This website uses cookies to improve user experience. By continuing to browse this website, you agree to the use of cookies as stated in our Cookies Policy.</p>
    <div class="buttons">
        <a class="button" href="/en/cookies.html">Read Cookies Policy</a>
        <button class="button" id="accept-cookies">Accept</button>
    </div>
</div>
<script>
    (function() {
        if(localStorage) {
            var cookiesAccepted = localStorage.getItem("cookies-accepted");
            if(cookiesAccepted) {
                hideCookiesMessage();
                
            } else {
                document.getElementById('accept-cookies').addEventListener("click", function() {
                    hideCookiesMessage();
                    localStorage.setItem("cookies-accepted", true);
                })
            }
        }
        function hideCookiesMessage() {
            document.getElementById('cookies-message').style.display = "none";
        }
    })();
</script>

  </body>

</html>