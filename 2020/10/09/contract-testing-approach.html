<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Estrategia de Contract Testing: Producer driven o Consumer driven</title>
  <meta name="description" content="En un post anterior hemos visto cómo surgen nuevas necesidades en el ámbito del testing derivadas de la evolución de las arquitecturas de las aplicaciones. E...">
  
  <meta name="keywords" content="testing,calidad,softwarequality,QA,contracttesting,consumer-drivencontract,consumerdrivencontract,pact,springcloudcontract">
  

  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@wearearima">
  <meta name="twitter:creator" content="@jessica">
  <meta name="twitter:title"   content="Estrategia de Contract Testing: Producer driven o Consumer driven">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary_large_image">
  <meta name="twitter:image" content="https://blog.arima.eu/assets/images/2020-10-09-contract-testing/header_recortado.jpg">
  
  <!-- end of Twitter cards -->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.arima.eu/2020/10/09/contract-testing-approach.html">
  <link rel="alternate" type="application/rss+xml" title="ARIMA" href="/feed.xml">

  <!-- SEO Recipes (http://polyglot.untra.io/seo/) -->
  <meta http-equiv="Content-Language" content="es">
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/2020/10/09/contract-testing-approach.html" />
  
  
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/es/2020/10/09/contract-testing-approach.html" />
  
  
  <link rel="alternate"
      hreflang="en"
      href="https://blog.arima.eu/en/2020/10/09/contract-testing-approach.html" />
  

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120217722-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120217722-1');
</script>
  
</head>

  <body>
    <nav class="toolbar">
    <div class="wrapper">    
        <a href="/">
            <div class="toolbar__logo">
                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" width="100%" height="100%" viewBox="0 0 33 6">
    <path id="path24" d="m30.346988508615652,-0.000015174522529526127 l-0.6439224998849951,0 l-2.7763635316117727,6.135695064030662 l0.7050150612484405,0 l2.3859233880279893,-5.335002838884215 l2.3660424189063254,5.335002838884215 l0.739668694925785,0 L30.346988508615652,-0.000015174522529526127 zm-8.274141805179609,3.3681675186951847 l-2.2194202716340565,-3.324608867598761 l-0.6962481061149294,0 l0,6.092136412934239 l0.6700853029999622,0 l0,-4.926062349034439 l2.2194202716340565,3.2553706313868567 l0.034929758248478535,0 l2.2192131782057056,-3.2639304930920168 l0,4.934622210739599 l0.6873430886958508,0 l0,-6.092136412934239 l-0.6961100438293623,0 l-2.2192131782057056,3.324608867598761 zm-9.143036799396208,-1.5057072863948877 c0,-1.0964906719739773 -0.8613705996531913,-1.8189015812038738 -2.201748299081466,-1.8189015812038738 l-2.619662837493104,0 l0,6.092136412934239 l0.6876192132669849,0 l0,-5.456842805897188 l1.8799251114245357,0 c0.9833486289517317,0 1.5576187057681203,0.4525681720889824 1.5576187057681203,1.2097017461390067 c0,0.7919252700129356 -0.7831583148794242,1.2620273523689407 -1.6968545207625496,1.2620273523689407 l0,0.6178287279128115 l1.7665759749739396,2.3672849794764295 l0.8442508762428699,0 l-1.8711581562910244,-2.4891249464894027 c0.9571858258367647,-0.17416557324290774 1.6534339319516944,-0.7659695603263191 1.6534339319516944,-1.7841098852409623 m2.7743616284710493,4.273234831730365 l0.6872050264102838,0 l0,-6.0920673817914555 l-0.6872050264102838,0 l0,6.0920673817914555 zM2.7761571742923965,-0.000015174522529526127 l-2.7761564381834223,6.135695064030662 l0.7048769989628736,0 l2.386061450313556,-5.335002838884215 l2.3658353254779745,5.335002838884215 l0.739668694925785,0 l-2.7761564381834223,-6.135695064030662 l-0.6441295933133457,0 z" stroke-width="0"/>
</svg>

            </div>
        </a>
        <!-- Language selector -->
        <div class="language-selector">
            
              
                <b class="selected">ES</b>
              
              
                &nbsp;|&nbsp;
              
            
              
                <a class="unselected" href="/en/2020/10/09/contract-testing-approach.html">EN</a>
              
              
            
         </div>
    </div>
</nav>
<div id="publisher_id" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Arima 100% Software Design" />
    <meta itemprop="url" content="https://arima.eu" />
    <div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
        <meta itemprop="url" content="https://arima.eu/img/logo.png" />
    </div>
</div>
    <main aria-label="Content">        
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting" itemref="publisher_id">
          <link itemprop="mainEntityOfPage" href="/2020/10/09/contract-testing-approach.html" />

          <header class="post-header">
            <div class="post-img" itemprop="image" itemscope itemtype="http://schema.org/ImageObject" style="background-image: url('https://blog.arima.eu/assets/images/2020-10-09-contract-testing/header_recortado.jpg');">
              <meta itemprop="url" content="https://blog.arima.eu/assets/images/2020-10-09-contract-testing/header_recortado.jpg" />
            </div>
            <div class="wrapper">
              <div class="post-info__container">
                <div class="post-info">
                  <h1 class="post-title" itemprop="name headline">Estrategia de Contract Testing: Producer driven o Consumer driven</h1>
                    <div class="post-meta" itemscope itemtype="https://schema.org/Person" itemprop="author">
                      
                      <div class="author-photo">
                        <img itemprop="image" src="/assets/images/authors/jessica.png" alt="">
                      </div>
                      <div>
                        <span class="post-author" itemprop="name">Jessica Aguado</span>
                      </div>
                      <div>
                        <span class="post-date">09 Oct 2020</span>
                      </div>
                    </div>
                    <meta  itemprop="datePublished dateModified" content="09 Oct 2020" />
                </div>
              </div>
            </div>
          </header>
          <div class="wrapper">
            <div class="post-content" itemprop="articleBody">
              <p>En un <a href="https://blog.arima.eu/es/2020/09/03/contract-testing.html" target="_blank">post anterior</a> hemos visto cómo surgen nuevas necesidades en el ámbito del testing derivadas de la evolución de las arquitecturas de las aplicaciones. En él, hablamos de cómo con el paso de los años hemos pasado de desarrollar aplicaciones basadas en una arquitectura monolítica a aplicaciones basadas en (micro)servicios. Donde antes teníamos tests centralizados en una única aplicación, ahora pasamos a tenerlos divididos en varias, de forma que tendremos testeadas cada una de ellas de forma independiente y estanca.</p>

<p>Hemos presentado un ejemplo sencillo de una aplicación, que nos ha servido para establecer algunos conceptos (como <em>consumer</em>, <em>producer</em>, <em>servicio</em>) y que nos ha permitido poner en evidencia una nueva necesidad: tan importante como testear las funcionalidades en <em>consumer</em> y <em>producer</em> de forma independiente lo es asegurar que la interacción entre ambos es correcta. Esta necesidad podemos abordarla mediante test <em>end-to-end</em>, pero si bien estos tests ya resultan complejos de implementar/ejecutar en aplicaciones monolíticas en aquellas que no los son la complejidad es mayor.</p>

<p>En este punto surge una idea: podría ser suficiente con verificar entre <em>consumer</em> y <em>producer</em>  que existe un acuerdo que ambos cumplen. Aquí es donde descubrimos un nuevo concepto: <strong>Contract Testing</strong>.</p>

<p>Y ¿qué es <strong>Contract Testing</strong>? En la documentación de Pact encontramos la siguiente <a href="https://docs.pact.io/#what-is-contract-testing" target="_blank">definición</a></p>
<blockquote>
  <p>Es una técnica que nos permite probar la integración de varias aplicaciones, verificando en cada una de ellas que los mensajes que envía o recibe (dependiendo de su rol <em>consumer/producer</em>) se ajustan a un acuerdo que está documentado en un contrato.</p>
</blockquote>

<p>Este concepto podríamos desgranarlo y traducirlo (a nivel práctico) en los siguientes puntos:</p>
<ul>
  <li>Existirá un acuerdo concreto definido al que tanto <em>consumer</em> como <em>producer</em> tendrán acceso.</li>
  <li>En el <em>consumer</em>, tendremos tests donde las peticiones se harán a un “stub” del <em>producer</em> que cumplirá el acuerdo definido.</li>
  <li>En el <em>producer</em>, tendremos tests donde se realizarán peticiones basadas en el acuerdo definido.</li>
</ul>

<p>Dependiendo de la herramienta/framework que tomemos como referencia, el concepto de “acuerdo entre <em>consumer</em> y <em>producer</em>” recibe el nombre de <strong>pacto</strong> o <strong>contrato</strong>. Pero no dejan de ser diferentes nombres para el mismo concepto: una especificación de cómo deben ser las llamadas y respuestas para consumir los servicios ofertados por el <em>producer</em>.</p>

<p>Volviendo al mismo ejemplo que hemos utilizado en el post anterior esta idea podríamos representarla como sigue:</p>

<p><img src="/assets/images/2020-10-09-contract-testing/01_schema_app_simplificado_agreement.jpg" alt="Ejemplo del esquema de una aplicacion con consumer-producer donde se resalta la parte en la que se centra el Contract Testing" class="center" /></p>

<p>Una vez presentado el concepto detrás de <em>Contract Testing</em> en términos generales, vamos a profundizar un poco más viendo los enfoques y herramientas existentes.</p>

<h1 id="enfoques">Enfoques</h1>
<p>En la literatura principalmente encontramos la relación <strong><em>Contract Testing</em></strong> → <strong><em>Consumer Driven Contract Testing</em></strong>. Esto al principio hizo que me resultase más difícil comprender el concepto subyacente. Tras leer varios post, documentación…. llegué a la conclusión de que el motivo de esta asociación parte de la idea de que un <em>servicio</em> de un <em>producer</em> carece de sentido si no hay alguna aplicación utilizándolo (<em>consumer</em>). Por tanto, parece lógico que quien establezca qué acuerdo debe cumplirse sea el <em>consumer</em>, mientras que en el <em>producer</em> debería recaer la responsabilidad de satisfacer las necesidades fijadas por <em>consumer</em> (de ahí la coletilla de “Consumer Driven”).</p>

<p>Vale, bien, pero en los proyectos que he conocido de cerca, la casuística no ha sido precisamente esa. El escenario ha sido el de un <em>producer</em> transversal a varias aplicaciones, que no conoce a sus <em>consumers</em>, y a quienes les oferta unos servicios determinados.</p>

<p>Así que, no me terminaba de encajar. Tuve que dar un paso atrás y verlo en perspectiva para llegar a entender que, en realidad, podríamos encontrarnos con dos situaciones en función del proyecto que tuviésemos entre manos (diferentes en forma pero iguales en concepto) y así dependiendo de quién sea el que define el acuerdo podríamos tener dos enfoques:</p>

<ul>
  <li><strong><em>Consumer Driven</em> Contract Testing</strong></li>
  <li><strong><em>Producer Driven</em> Contract Testing</strong></li>
</ul>

<p>¿Por qué no? El nombre no deja lugar a dudas: en un caso la definición del contrato nace en el <em>consumer</em> y en el otro del <em>producer</em>. La verdad es que hubo un momento en que <em>Producer Driven Contract Testing</em> parecía que fuese invención mía (no hay más que ver la búsqueda en Google de este término o de provider-driven…), pero encontré una referencia a ese término (como veremos un poquito más adelante) lo cual me dió pie a continuar con mi esquema mental.</p>

<p>El concepto base, en ambos casos, no deja de ser el mismo. Sin embargo dependiendo del enfoque que encaje mejor con nuestro proyecto podremos decantarnos por uno u otro. Lo mismo sucede a la hora de elegir las herramientas para hacerlo: dependiendo de nuestras necesidades podremos elegir entra las diferentes herramientas existentes.</p>

<h1 id="herramientas">Herramientas</h1>

<p>Basándonos en el ejemplo presentado al inicio (y sabiendo que es un proyecto Spring Boot gestionado con Maven), las herramientas más populares que hemos encontrado que podríamos utilizar en nuestro proyecto son:</p>

<ul>
  <li>
    <p><strong>Pact</strong></p>

    <p>Esta herramienta está fuertemente acoplada con <em>Consumer Driven Contract Testing</em>, básicamente porque los pactos estarán siempre en la parte <em>consumer</em>. En la <a href="https://docs.pact.io/#consumer-driven-contracts" target="_blank">documentación</a> podemos leer:</p>

    <blockquote>
      <p>Pact is a code-first consumer-driven contract testing tool, …. 
The contract is generated during the execution of the automated consumer tests</p>
    </blockquote>
  </li>
  <li>
    <p><strong>Spring Cloud Contract</strong></p>

    <p>Aunque en su <a href="https://spring.io/projects/spring-cloud-contract" target="_blank">descripción</a> dice:</p>
    <blockquote>
      <p>Spring Cloud Contract is an umbrella project holding solutions that help users in successfully implementing the Consumer Driven Contracts approach. Currently Spring Cloud Contract consists of the Spring Cloud Contract Verifier project.</p>
    </blockquote>

    <p>Puede utilizarse tanto en un sentido como en otro. De hecho, en la documentación <a href="https://docs.pact.io/getting_started/comparisons/#how-does-pact-differ-from-spring-cloud-contract" target="_blank">Pact</a> indican que Spring Cloud Contract nació con el enfoque provider-driven.</p>
    <blockquote>
      <p>Pact has always been a consumer-driven contract testing framework whereas Spring Cloud Contract started as provider-driven.</p>
    </blockquote>

    <p>¡Parece que no me he inventado el término!, tampoco estaré tan desencaminada ¿no?</p>
  </li>
</ul>

<p>Hasta aquí el proceso que seguí hasta llegar a comprender que detrás <strong>Contract Testing</strong> hay más de un enfoque y múltiples herramientas. Como siempre, dependerá del proyecto que tengamos entre manos para elegir lo que más nos encaje.<br />
 Mucha chapa y poco código, ¿verdad? Yo soy de las que para aprender/entender realmente algo tengo que ponerlo en práctica…. así que si te pasa lo mismo que a mí, no te preocupes, aquí no terminamos: en breve publicaré un pequeño ejemplo utilizando <strong>Spring Cloud Contract</strong>.</p>

            </div>

            
          </div>
        </article>
      </div>
    </main>

    <footer>
    <div class="wrapper">
        <div class="footer__container">
            <div class="footer__sello">
                <img src="/assets/images/arima_sello_white.png" alt="" />
            </div>
            <div class="footer__content">
                <div class="footer__data">
                    <dl>
                        <dt>web</dt>
                        <dd><a itemprop="sameAs" href="https://www.arima.eu/es/">arima.eu</a></dd>
                    </dl>
                    <dl>
                        <dt>social</dt>
                        <dd>
                            <a itemprop="sameAs" href="https://github.com/wearearima" class="social"><span class="icon-github"></span></a>
                            <a itemprop="sameAs" href="https://twitter.com/wearearima" class="social"><span class="icon-twitter"></span></a>
                            <a itemprop="sameAs" href="https://www.linkedin.com/company/arima-software-design/" class="social"><span class="icon-linkedin"></span></a>
                            <a itemprop="sameAs" href="/feed.xml" class="social"><span class="icon-feed"></span></a>
                        </dd>
                    </dl>
                    <dl>
                        <dt>Privacidad</dt>
                        <dd class="politica-cookies">
                            <a href="/cookies.html">Política de cookies</a>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</footer>
    <div class="cookies-message" id="cookies-message">
    <h4>Este sitio web utiliza cookies</h4>
    <p>Este sitio web utiliza cookies para mejorar la experiencia del usuario. Al utilizar nuestro sitio web, usted acepta todas las cookies de acuerdo con nuestra Política de cookies.</p>
    <div class="buttons">
        <a class="button" href="/cookies.html">Leer política de cookies</a>
        <button class="button" id="accept-cookies">Aceptar</button>
    </div>
</div>
<script>
    (function() {
        if(localStorage) {
            var cookiesAccepted = localStorage.getItem("cookies-accepted");
            if(cookiesAccepted) {
                hideCookiesMessage();
                
            } else {
                document.getElementById('accept-cookies').addEventListener("click", function() {
                    hideCookiesMessage();
                    localStorage.setItem("cookies-accepted", true);
                })
            }
        }
        function hideCookiesMessage() {
            document.getElementById('cookies-message').style.display = "none";
        }
    })();
</script>

  </body>

</html>