<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Lecciones aprendidas sobre Contract Testing</title>
  <meta name="description" content="A lo largo de varios posts, hemos ido viendo c√≥mo a consecuencia de la evoluci√≥n de las arquitecturas de las aplicaciones surgen nuevas necesidades en el √°mb...">
  
  <meta name="keywords" content="testing,calidad,softwarequality,QA,contracttesting,consumer-drivencontracttesting,consumerdrivencontracttesting,provider-drivencontracttesting,providerdrivencontracttesting">
  

  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@wearearima">
  <meta name="twitter:creator" content="@jessica">
  <meta name="twitter:title"   content="Lecciones aprendidas sobre Contract Testing">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary_large_image">
  <meta name="twitter:image" content="https://blog.arima.eu/assets/images/2021-02-08-contract-testing/header.jpg">
  
  <!-- end of Twitter cards -->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.arima.eu/es/2021/02/08/contract-testing-lessons-learned.html">
  <link rel="alternate" type="application/rss+xml" title="ARIMA" href="/es/feed.xml">

  <!-- SEO Recipes (http://polyglot.untra.io/seo/) -->
  <meta http-equiv="Content-Language" content="es">
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/es/2021/02/08/contract-testing-lessons-learned.html" />
  
  
  <link rel="alternate"
      hreflang="es"
      href="https://blog.arima.eu/es/2021/02/08/contract-testing-lessons-learned.html" />
  
  
  <link rel="alternate"
      hreflang="en"
      href="https://blog.arima.eu/en/2021/02/08/contract-testing-lessons-learned.html" />
  

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120217722-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120217722-1');
</script>
  
</head>

  <body>
    <nav class="toolbar">
    <div class="wrapper">    
        <a href="/es/">
            <div class="toolbar__logo">
                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" width="100%" height="100%" viewBox="0 0 33 6">
    <path id="path24" d="m30.346988508615652,-0.000015174522529526127 l-0.6439224998849951,0 l-2.7763635316117727,6.135695064030662 l0.7050150612484405,0 l2.3859233880279893,-5.335002838884215 l2.3660424189063254,5.335002838884215 l0.739668694925785,0 L30.346988508615652,-0.000015174522529526127 zm-8.274141805179609,3.3681675186951847 l-2.2194202716340565,-3.324608867598761 l-0.6962481061149294,0 l0,6.092136412934239 l0.6700853029999622,0 l0,-4.926062349034439 l2.2194202716340565,3.2553706313868567 l0.034929758248478535,0 l2.2192131782057056,-3.2639304930920168 l0,4.934622210739599 l0.6873430886958508,0 l0,-6.092136412934239 l-0.6961100438293623,0 l-2.2192131782057056,3.324608867598761 zm-9.143036799396208,-1.5057072863948877 c0,-1.0964906719739773 -0.8613705996531913,-1.8189015812038738 -2.201748299081466,-1.8189015812038738 l-2.619662837493104,0 l0,6.092136412934239 l0.6876192132669849,0 l0,-5.456842805897188 l1.8799251114245357,0 c0.9833486289517317,0 1.5576187057681203,0.4525681720889824 1.5576187057681203,1.2097017461390067 c0,0.7919252700129356 -0.7831583148794242,1.2620273523689407 -1.6968545207625496,1.2620273523689407 l0,0.6178287279128115 l1.7665759749739396,2.3672849794764295 l0.8442508762428699,0 l-1.8711581562910244,-2.4891249464894027 c0.9571858258367647,-0.17416557324290774 1.6534339319516944,-0.7659695603263191 1.6534339319516944,-1.7841098852409623 m2.7743616284710493,4.273234831730365 l0.6872050264102838,0 l0,-6.0920673817914555 l-0.6872050264102838,0 l0,6.0920673817914555 zM2.7761571742923965,-0.000015174522529526127 l-2.7761564381834223,6.135695064030662 l0.7048769989628736,0 l2.386061450313556,-5.335002838884215 l2.3658353254779745,5.335002838884215 l0.739668694925785,0 l-2.7761564381834223,-6.135695064030662 l-0.6441295933133457,0 z" stroke-width="0"/>
</svg>

            </div>
        </a>
        <!-- Language selector -->
        <div class="language-selector">
            
              
                <b class="selected">ES</b>
              
              
                &nbsp;|&nbsp;
              
            
              
                <a class="unselected" href="/en/2021/02/08/contract-testing-lessons-learned.html">EN</a>
              
              
            
         </div>
    </div>
</nav>
<div id="publisher_id" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Arima 100% Software Design" />
    <meta itemprop="url" content="https://arima.eu" />
    <div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
        <meta itemprop="url" content="https://arima.eu/img/logo.png" />
    </div>
</div>
    <main aria-label="Content">        
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting" itemref="publisher_id">
          <link itemprop="mainEntityOfPage" href="/es/2021/02/08/contract-testing-lessons-learned.html" />

          <header class="post-header">
            <div class="post-img" itemprop="image" itemscope itemtype="http://schema.org/ImageObject" style="background-image: url('https://blog.arima.eu/assets/images/2021-02-08-contract-testing/header.jpg');">
              <meta itemprop="url" content="https://blog.arima.eu/assets/images/2021-02-08-contract-testing/header.jpg" />
            </div>
            <div class="wrapper">
              <div class="post-info__container">
                <div class="post-info">
                  <h1 class="post-title" itemprop="name headline">Lecciones aprendidas sobre Contract Testing</h1>
                    <div class="post-meta" itemscope itemtype="https://schema.org/Person" itemprop="author">
                      
                      <div class="author-photo">
                        <img itemprop="image" src="/assets/images/authors/jessica.png" alt="">
                      </div>
                      <div>
                        <span class="post-author" itemprop="name">Jessica Aguado</span>
                      </div>
                      <div>
                        <span class="post-date">08 Feb 2021</span>
                      </div>
                    </div>
                    <meta  itemprop="datePublished dateModified" content="08 Feb 2021" />
                </div>
              </div>
            </div>
          </header>
          <div class="wrapper">
            <div class="post-content" itemprop="articleBody">
              <p>A lo largo de varios posts, hemos ido viendo c√≥mo a consecuencia de la evoluci√≥n de las arquitecturas de las aplicaciones surgen nuevas necesidades en el √°mbito del testing. Nos hemos centrado en una concreta: tan importante como testear las funcionalidades en <em>consumer</em> y <em>producer</em> de forma independiente lo es asegurar que <a href="https://blog.arima.eu/es/2020/09/03/contract-testing.html" target="_blank">la interacci√≥n entre ambos es correcta</a>. Hemos visto que tenemos a nuestro alcance <strong>Contract Testing</strong>, con <a href="https://blog.arima.eu/es/2020/10/09/contract-testing-approach.html" target="_blank">diferentes enfoques y herramientas</a> que nos permiten abordar esta necesidad en concreto. Adem√°s utilizando el enfoque <strong>producer driven</strong> y <a href="https://spring.io/projects/spring-cloud-contract" target="_blank"><strong>Spring Cloud Contract</strong></a> hemos <a href="https://blog.arima.eu/es/2020/10/29/playing-with-spring-cloud-contract.html" target="_blank">llevado a la pr√°ctica</a> todo lo aprendido.</p>

<p>Estaba pensando en c√≥mo terminar esta serie de posts, con una recopilaci√≥n de lecciones aprendidas‚Ä¶ Algo as√≠ como un minipost resumiendo todo lo que hemos visto hasta ahora en cuatro o cinco titulares.<br />
Haciendo este ejercicio de reflexi√≥n, he recordado que en mi proceso de aprendizaje hubo una lecci√≥n que destac√≥ frente al resto. Puede que haya gente para la que resulte obvia pero seguro que hay alguien por ah√≠ que puede meterse en el mismo callej√≥n que me met√≠ yo en su momento‚Ä¶ As√≠ que, para ese ‚Äúalguien‚Äù üòâ aqu√≠ mi granito de arena:</p>
<blockquote>
  <p>Hacer Contract Testing <strong>no</strong> te exime de hacer Unit Testing o Integration Testing.</p>
</blockquote>

<p>Vale, ya s√© que esto es lo que pone en todos los sitios, que no estoy diciendo nada nuevo‚Ä¶. pero bueno, yo estuve tentada de hacerlo‚Ä¶ quiz√°s t√∫ que me lees tambi√©n‚Ä¶. y ya sab√©is mi mantra: <em>materializar para entender</em> üòä.<br />
Vamos a partir del ejemplo en el que hemos utilizado Spring Cloud Contract. Ya sabemos de qu√© va y controlamos el ejemplo.</p>

<p>Viendo los tests del <em>consumer</em>, podr√≠amos pensar‚Ä¶</p>

<p>üí° Ey! Ser√≠a genial tener las casu√≠sticas que necesito para mi l√≥gica representadas en el stub as√≠ me ahorrar√≠a el test unitario donde tengo mockeadas todas esas situaciones</p>

<p>¬°Qu√© buena idea!</p>

<p>ü§î Ya pero el <em>producer</em> no tiene por qu√© conocer mis casu√≠sticas y es quien ha creado el contrato.</p>

<p>Prf! Es verdad‚Ä¶ ¬øc√≥mo se me habr√° ocurrido? ¬øEn qu√© estar√≠a pensando ‚Ä¶..?</p>

<p>üí° Wait! ¬°Lo que necesito son <em>consumer driven contracts</em>!</p>

<p>Puedo crear los contratos desde el <em>consumer</em> con la informaci√≥n que necesito y hacer que los contratos est√©n disponibles en el <em>producer</em> mediante pull-request (por ejemplo). Como los tests del <em>producer</em> son autogenerados no se va a enterar‚Ä¶ ¬°Perfecto! ¬°Enacaja! ¬°Manos a la obra!</p>

<p>Si echamos un vistazo a los tests del <em>consumer</em> vemos que b√°sicamente queremos probar tres situaciones: cuando la duraci√≥n de los worklogs es de 8 horas, de m√°s de 8 horas y de menos de 8 horas.</p>

<p>Generamos por tanto los nuevos contratos y los dejamos para que est√©n accesibles desde el <em>producer</em>. A continuaci√≥n mostramos c√≥mo podr√≠a ser (el c√≥digo completo de todos los pasos que daremos, junto con los .json, est√° en <a href="https://github.com/wearearima/time-report-ContractTesting-03" target="_blank">Github</a>).</p>

<h4 id="worklogsforworkeranddayyaml">worklogsForWorkerAndDay.yaml</h4>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">description</span><span class="pi">:</span> <span class="s">Given a worker's username and a day it returns worklogs with 8 hours</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">worklogsForWokerAndDay_with_8hours_worklogs</span>
<span class="na">request</span><span class="pi">:</span>
   <span class="na">url</span><span class="pi">:</span> <span class="s">/worklogs/worker/JESSI</span>
   <span class="na">queryParameters</span><span class="pi">:</span>
      <span class="na">day</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2020-05-01"</span>
   <span class="na">method</span><span class="pi">:</span> <span class="s">GET</span>
   <span class="na">matchers</span><span class="pi">:</span>
    <span class="na">url</span><span class="pi">:</span>
      <span class="na">regex</span><span class="pi">:</span> <span class="s">/worklogs/worker/([a-zA-Z]*)</span>    
<span class="na">response</span><span class="pi">:</span>
   <span class="na">status</span><span class="pi">:</span> <span class="m">200</span>
   <span class="na">headers</span><span class="pi">:</span>
      <span class="na">Content-Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">application/json"</span>
   <span class="na">bodyFromFile</span><span class="pi">:</span> <span class="s">worklogs_8hours.json</span>

<span class="nn">---</span>   
<span class="na">description</span><span class="pi">:</span> <span class="s">Given a worker's username and a day it returns worklogs that sum more than 8 hours</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">worklogsForWokerAndDay_with_moreThan8hours_worklogs</span>
<span class="na">request</span><span class="pi">:</span>
   <span class="na">url</span><span class="pi">:</span> <span class="s">/worklogs/worker/JESSI</span>
   <span class="na">queryParameters</span><span class="pi">:</span>
      <span class="na">day</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2020-05-05"</span>
   <span class="na">method</span><span class="pi">:</span> <span class="s">GET</span>
   <span class="na">matchers</span><span class="pi">:</span>
    <span class="na">url</span><span class="pi">:</span>
      <span class="na">regex</span><span class="pi">:</span> <span class="s">/worklogs/worker/([a-zA-Z]*)</span>    
<span class="na">response</span><span class="pi">:</span>
   <span class="na">status</span><span class="pi">:</span> <span class="m">200</span>
   <span class="na">headers</span><span class="pi">:</span>
      <span class="na">Content-Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">application/json"</span>
   <span class="na">bodyFromFile</span><span class="pi">:</span> <span class="s">worklogs_moreThan8hours.json</span>
   
<span class="nn">---</span>   
<span class="na">description</span><span class="pi">:</span> <span class="s">Given a worker's username and a day it returns worklogs that sum less than 8 hours</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">worklogsForWokerAndDay_with_lessThan8hours_worklogs</span>
<span class="na">request</span><span class="pi">:</span>
   <span class="na">url</span><span class="pi">:</span> <span class="s">/worklogs/worker/JESSI</span>
   <span class="na">queryParameters</span><span class="pi">:</span>
      <span class="na">day</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2020-05-10"</span>
   <span class="na">method</span><span class="pi">:</span> <span class="s">GET</span>
   <span class="na">matchers</span><span class="pi">:</span>
    <span class="na">url</span><span class="pi">:</span>
      <span class="na">regex</span><span class="pi">:</span> <span class="s">/worklogs/worker/([a-zA-Z]*)</span>    
<span class="na">response</span><span class="pi">:</span>
   <span class="na">status</span><span class="pi">:</span> <span class="m">200</span>
   <span class="na">headers</span><span class="pi">:</span>
      <span class="na">Content-Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">application/json"</span>
   <span class="na">bodyFromFile</span><span class="pi">:</span> <span class="s">worklogs_lessThan8hours.json</span>
</code></pre></div></div>

<p>En √©l hemos generado las 3 situaciones que quer√≠amos.<br />
Con el contrato definido, es hora de generar el stub en el <em>producer</em>. Hacemos <code class="highlighter-rouge">./mvnw clean install</code> y vemos que aunque hemos cambiado el contrato con Spring Cloud Contract se autogeneran los tests, as√≠ que todo va seg√∫n lo previsto y no tenemos que tocar nada del <em>producer</em>.</p>

<p>Como ya tenemos accesible el stub con las casu√≠sticas generadas desde el <em>consumer</em>, ya podr√≠amos borrar nuestros tests unitarios e implementarlos haciendo llamadas al stub directamente. El c√≥digo quedar√≠a:</p>

<h4 id="consumer--reportsservicetestjava">Consumer | ReportsServiceTest.java</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">SpringExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">properties</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"server.url=http://localhost:8083"</span> <span class="o">})</span>
<span class="nd">@AutoConfigureStubRunner</span><span class="o">(</span><span class="n">ids</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"eu.arima.tr:timeReports-producer:+:stubs:8083"</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReportsServiceTest</span> <span class="o">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">ReportsService</span> <span class="n">reportsService</span><span class="o">;</span>

  <span class="nd">@Test</span>
  <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"Given a worklog with 8 hours duration the status is RIGHT_HOURS"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">when_the_worklog_for_the_resquested_day_is_8_hours_the_status_is_RIGHT_HOURS</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="nc">LocalDate</span> <span class="n">day</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mo">05</span><span class="o">,</span> <span class="mo">01</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"JESSI"</span><span class="o">;</span>

    <span class="nc">DayStatusSummary</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reportsService</span><span class="o">.</span><span class="na">getDayStatusSummaryForWorkerAndDay</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">day</span><span class="o">);</span>

    <span class="n">assertStatusEquals</span><span class="o">(</span><span class="no">RIGHT_HOURS</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"Given a list of worklogs with more than 8 hours duration the status is MISSING_HOURS"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">when_the_worklogs_for_resquested_day_are_more_than_8_hours_the_status_is_MISSING_HOURS</span><span class="o">()</span>
      <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="nc">LocalDate</span> <span class="n">day</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mo">05</span><span class="o">,</span> <span class="mo">05</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"JESSI"</span><span class="o">;</span>

    <span class="nc">DayStatusSummary</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reportsService</span><span class="o">.</span><span class="na">getDayStatusSummaryForWorkerAndDay</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">day</span><span class="o">);</span>

    <span class="n">assertStatusEquals</span><span class="o">(</span><span class="nc">DayStatus</span><span class="o">.</span><span class="na">EXTRA_HOURS</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"Given a list of worklogs with less than 8 hours duration the status is MISSING_HOURS"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">when_the_worklogs_for_resquested_day_are_less_than_8_hours_the_status_is_MISSING_HOURS</span><span class="o">()</span>
      <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="nc">LocalDate</span> <span class="n">day</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mo">05</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"JESSI"</span><span class="o">;</span>

    <span class="nc">DayStatusSummary</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reportsService</span><span class="o">.</span><span class="na">getDayStatusSummaryForWorkerAndDay</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">day</span><span class="o">);</span>

    <span class="n">assertStatusEquals</span><span class="o">(</span><span class="no">MISSING_HOURS</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"Given the username of a worker the status result has that username"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">the_status_result_belongs_to_the_requested_worker</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="nc">LocalDate</span> <span class="n">day</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mo">05</span><span class="o">,</span> <span class="mo">01</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"JESSI"</span><span class="o">;</span>

    <span class="nc">DayStatusSummary</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reportsService</span><span class="o">.</span><span class="na">getDayStatusSummaryForWorkerAndDay</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">day</span><span class="o">);</span>

    <span class="n">assertEquals</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getWorkerUserName</span><span class="o">());</span>

  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"Given a date the status result has that date"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">the_status_result_belongs_to_the_requested_day</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="nc">LocalDate</span> <span class="n">day</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mo">05</span><span class="o">,</span> <span class="mo">01</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"JESSI"</span><span class="o">;</span>

    <span class="nc">DayStatusSummary</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reportsService</span><span class="o">.</span><span class="na">getDayStatusSummaryForWorkerAndDay</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">day</span><span class="o">);</span>

    <span class="n">assertEquals</span><span class="o">(</span><span class="n">day</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getDate</span><span class="o">());</span>

  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<p>¬°Genial! Todo queda mucho m√°s limpio ¬ø¬°C√≥mo no se me habr√° ocurrido antes!?</p>

<p>Pero ¬øqu√© suceder√≠a si modificamos la l√≥gica de nuestro <em>consumer</em>? 
Por ejemplo, supongamos que contemplamos la casu√≠stica del verano, cuando en lugar de jornadas de 8 horas tenemos jornadas de 7 horas.<br />
Para introducir este cambio, como m√≠nimo tendr√≠amos que:</p>

<ol>
  <li>Modificar el contrato y a√±adir m√°s casu√≠sticas para que en funci√≥n de los par√°metros de entrada nos devuelva otros datos</li>
  <li>Hacer llegar al <em>producer</em> el contrato (por ejemplo PR)</li>
  <li>Regenerar elementos del <em>producer</em> como los tests y el stub (<code class="highlighter-rouge">./mvnw clean install</code>)</li>
  <li>Modificar los tests en el <em>consumer</em> para a√±adir las nuevas casu√≠sticas</li>
</ol>

<p>Estamos modificando el contrato cuando en realidad no ha habido cambios en el ‚Äúacuerdo‚Äù entre <em>consumer</em> y <em>producer</em>. Estamos utilizando las bondades de Spring Cloud Contract como un m√©todo de generaci√≥n de datos ‚Äúmock‚Äù para nuestra l√≥gica de negocio‚Ä¶ Algo no suena bien. Si no hubi√©semos hecho el cambio, √∫nicamente tendr√≠amos que hacer el paso 4. Parece que no ha sido tan buena idea ¬øno?<br />
¬øPoder se puede? S√≠. Sin embargo, un gran poder conlleva una gran responsabilidad‚Ä¶ y <strong>que se pueda no quiere decir que se deba</strong>.</p>

<p>Despu√©s de sufrirlo en nuestras propias carnes, nos rendimos ante la conclusi√≥n que hemos destacado al principio: Contract testing no sustituye ni a los tests unitarios, ni a los de integraci√≥n, ni otros tests que podamos tener en nuestros proyectos. Contract testing es una herramienta m√°s, un complemento a los anteriores cuyo objetivo NO ES verificar/asegurar el buen funcionamiento de la l√≥gica de negocio (ni de consumidores ni de proveedores) para eso est√°n los test unitarios o de integraci√≥n de cada uno de ellos. Su objetivo ES asegurar que se cumplen los acuerdos entre <em>consumer</em> y <em>producer</em> que hacen que la interacci√≥n entre <em>consumer</em> y <em>producer</em> sea correcta.</p>

<p>La verdad es que somos propensos a descubrir una herramienta y si nos gusta y nos encaja utilizarla de forma indiscriminada. Como hemos visto, cuando estamos aplic√°ndolos podr√≠a parecernos que podr√≠amos llegar a prescindir de nuestros test unitarios, pero si seguimos indagando, vemos que lo que nos parec√≠a el descubrimiento del d√≠a no es tan buena idea, todo lo contrario.</p>

<h1 id="lecciones-aprendidas">Lecciones aprendidas</h1>
<p>Bueno pues ya llega el momento del resumen. Vamos a ver qu√© hemos aprendido a lo largo de estos posts.</p>

<ul>
  <li>
    <p>Tenemos una herramienta m√°s que nos sirve para el testeo de aplicaciones de (micro)servicios y que no aplica en aplicaciones monol√≠ticas.</p>
  </li>
  <li>
    <p>Como con el resto de tipos/t√©cnicas de tests, hay que buscar el equilibrio y tener claro el objetivo de los mismos, en este caso: testear el acuerdo (contrato o pacto) entre <em>consumer</em> y <em>producer</em> (ni m√°s ni menos) y no utilizarlos de forma indiscriminada.</p>
  </li>
  <li>
    <p>En proyectos donde el <em>producer</em> sea transversal a varios <em>consumers</em> (cuyo desarrollo no est√© acoplado entre s√≠) y/o p√∫blico, parece m√°s apropiada la aproximaci√≥n o el enfoque <em>producer</em> driven, donde es el <em>producer</em> quien define c√≥mo ser√° el acuerdo a cumplir en la comunicaci√≥n.</p>
  </li>
  <li>
    <p>En proyectos donde el <em>producer</em> no tiene raz√≥n de ser sin el <em>consumer</em>, y cuyo desarrollos est√°n m√°s acoplados, parece m√°s apropiado el enfoque de <em>consumer</em> driven, donde ser√° el (o los) <em>consumer(s)</em> quienes indicar√°n al <em>producer</em> sus necesidades estableciendo el acuerdo a cumplir en la comunicaci√≥n</p>
  </li>
  <li>
    <p>C√≥mo implementar/organizar el testing depender√° del enfoque seleccionado y de la naturaleza del proyecto: no existe una receta √∫nica y universal para hacer buen testing.</p>
  </li>
</ul>

            </div>

            
          </div>
        </article>
      </div>
    </main>

    <footer>
    <div class="wrapper">
        <div class="footer__container">
            <div class="footer__sello">
                <img src="/assets/images/arima_sello_white.png" alt="" />
            </div>
            <div class="footer__content">
                <div class="footer__data">
                    <dl>
                        <dt>web</dt>
                        <dd><a itemprop="sameAs" href="https://www.arima.eu/es/">arima.eu</a></dd>
                    </dl>
                    <dl>
                        <dt>social</dt>
                        <dd>
                            <a itemprop="sameAs" href="https://github.com/wearearima" class="social"><span class="icon-github"></span></a>
                            <a itemprop="sameAs" href="https://twitter.com/wearearima" class="social"><span class="icon-twitter"></span></a>
                            <a itemprop="sameAs" href="https://www.linkedin.com/company/arima-software-design/" class="social"><span class="icon-linkedin"></span></a>
                            <a itemprop="sameAs" href="/es/feed.xml" class="social"><span class="icon-feed"></span></a>
                        </dd>
                    </dl>
                    <dl>
                        <dt>Privacidad</dt>
                        <dd class="politica-cookies">
                            <a href="/es/cookies.html">Pol√≠tica de cookies</a>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</footer>
    <div class="cookies-message" id="cookies-message">
    <h4>Este sitio web utiliza cookies</h4>
    <p>Este sitio web utiliza cookies para mejorar la experiencia del usuario. Al utilizar nuestro sitio web, usted acepta todas las cookies de acuerdo con nuestra Pol√≠tica de cookies.</p>
    <div class="buttons">
        <a class="button" href="/es/cookies.html">Leer pol√≠tica de cookies</a>
        <button class="button" id="accept-cookies">Aceptar</button>
    </div>
</div>
<script>
    (function() {
        if(localStorage) {
            var cookiesAccepted = localStorage.getItem("cookies-accepted");
            if(cookiesAccepted) {
                hideCookiesMessage();
                
            } else {
                document.getElementById('accept-cookies').addEventListener("click", function() {
                    hideCookiesMessage();
                    localStorage.setItem("cookies-accepted", true);
                })
            }
        }
        function hideCookiesMessage() {
            document.getElementById('cookies-message').style.display = "none";
        }
    })();
</script>

  </body>

</html>